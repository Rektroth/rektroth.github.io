<html>
	<head>
		<title>Rektroth - My Mods</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<style>
			body
			{
				font-family: Inter, Segoe UI, Oxygen, Ubuntu, Roboto, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;
				color: rgb(176, 186, 197);
				background-color: rgb(22, 24, 28);
				font-size: 16px;
				max-width: 800px;
				margin: auto;
			}
			
			h1,
			h2,
			h3,
			h4,
			h5,
			h6
			{
				margin-top: 0;
				margin-bottom: 0.2em;
				color: rgb(236, 249, 251)
			}
			
			h1
			{
				font-size: 28px;
			}
			
			h2
			{
				font-size: 26px;
			}
			
			h3
			{
				font-size: 24px;
			}
			
			h4
			{
				font-size: 22px;
			}
			
			h5
			{
				font-size: 20px;
			}
			
			h6
			{
				font-size: 18px;
			}
			
			a
			{
				color: rgb(116, 182, 243);
				text-decoration: none;
			}
			
			a:hover
			{
				color: #1a76e7;
			}
			
			.mod
			{
				display: flex;
				flex-wrap: wrap;
				background-color: rgb(38, 41, 47);
				padding: 1.5rem;
				border-radius: 1rem;
				margin: 1em;
			}
			
			.mod p
			{
				margin: 0;
				padding-right: 1em;
			}
			
			.mod .mod-icon,
			.mod a.mod-download
			{
				flex: 20%;
			}
			
			.mod .mod-description
			{
				flex: 60%;
			}
			
			.mod a.mod-download
			{
				text-align: center;
				font-weight: bold;
				font-size: 19px;
				margin: auto;
				padding: 0.5em 0;
				border-radius: 0.75rem;
				color: black;
			}

			.mod a.mod-download.updated
			{
				background-color: rgb(27, 217, 106);
			}

			.mod a.mod-download.outdated
			{
				background-color: rgb(255, 73, 110);
			}

			.mod a.mod-download svg
			{
				height: 1em;
			}
			
			.mod .mod-icon img,
			.mod .mod-icon svg
			{
				width: 96px;
				border-radius: 16px;
				background-color: rgb(67, 73, 86);
			}

			.loader {
				border: 8px solid #f3f3f3;
				border-radius: 50%;
				border-top: 8px solid #3498db;
				width: 48px;
				height: 48px;
				-webkit-animation: spin 2s linear infinite; /* Safari */
				animation: spin 2s linear infinite;
				margin: 0 auto;
			}

			@keyframes spin {
				0% { transform: rotate(0deg); }
				100% { transform: rotate(360deg); }
			}

			/* Safari */
			@-webkit-keyframes spin {
				0% { -webkit-transform: rotate(0deg); }
				100% { -webkit-transform: rotate(360deg); }
			}
		</style>
		<script>
			const SEMANTIC_REGEX = /^[0-9]+.[0-9]+(.[0-9]+)?$/;

			const MOD_TYPES = [
				'performance',
				'optifine',
				'fixes',
				'enhancements',
				'gui',
				'tools',
				'dependencies'
			];

			const MODS = [
				[
					'badoptimizations',
					'better-block-entities',
					'entityculling',
					'fast-ip-ping',
					'ferrite-core',
					'immediatelyfast',
					'krypton',
					'language-reload',
					'lithium',
					'moreculling',
					'noisiumforked',
					'nvidium',
					'particle-core',
					'scalablelux',
					'sodium'
				], [
					'animatica',
					'bobby',
					'continuity',
					'entity-model-features',
					'entitytexturefeatures',
					'iris',
					'lambdynamiclights',
					'optigui',
					'polytone',
					'skyboxify',
					'sodium-extra',
					'zoomify'
				], [
					'centered-crosshair',
					'debugify',
					'modernfix-mvus',
					'whiteout'
				], [
					'3dskinlayers',
					'dripsounds',
					'not-enough-animations',
					'particular-reforged',
					'sound-physics-remastered',
					'sound',
					'visuality',
					'wavey-capes'
				], [
					'better-f1-reborn',
					'betterf3',
					'better-mount-hud',
					'better-stats',
					'blur-plus',
					'chat-heads',
					'chatpatches',
					'fadeless',
					'locator-heads',
					'locator_lodestones',
					'paginatedadvancements',
					'reeses-sodium-options',
					'shulkerboxtooltip',
					'smooth-scroll',
					'smooth-swapping',
					'status-effect-bars',
					'tiny-item-animations'
				], [
					'cherished-worlds',
					'fabrishot',
					'jade',
					'litematica',
					'minihud',
					'modmenu',
					'no-chat-reports',
					'notes'
				], [
					'architectury-api',
					'cloth-config',
					'fabric-api',
					'fabric-language-kotlin',
					'forge-config-api-port',
					'fzzy-config',
					'malilib',
					'mru',
					'tcdcommons',
					'yacl'
				]
			];

			let latestMcRelease = '1.21.11';

			window.onload = async () => {
				latestMcRelease = await getLatestMinecraftRelease();

				// The DIV for each mod is first created and added to the document.
				for (let i = 0; i < MOD_TYPES.length && i < MODS.length; i++) {
					const modList = MODS[i];
					const type = MOD_TYPES[i];

					for (let j = 0; j < modList.length; j++) {
						const slug = modList[j];
						const documentList = document.getElementById(type + '-list');
						const modDiv = document.createElement('div');
						const loaderDiv = document.createElement('div');
						modDiv.classList.add('mod');
						modDiv.id = slug;
						loaderDiv.classList.add('loader');
						modDiv.appendChild(loaderDiv);
						documentList.appendChild(modDiv);
					}
				}

				// Then the data is loaded asynchronously, but the desired order is preserved.
				for (let i = 0; i < MOD_TYPES.length && i < MODS.length; i++) {
					const modList = MODS[i];

					for (let j = 0; j < modList.length; j++) {
						const slug = modList[j];
						const modDiv = document.getElementById(slug);
						loadMod(slug, modDiv);
					}
				}
			}

			async function loadMod(slug, modDiv) {
				const mod = await getMod(slug);
				const divHtml = createDivHtml(mod);
				modDiv.innerHTML = divHtml;
			}

			async function getMod(slug) {
				const response = await callProjectApi(slug);
				const version = await getLatestVersion(response.game_versions)
				const download = await getLatestVersionUrl(slug, version);

				return {
					slug: response.slug,
					title: response.title,
					description: response.description,
					icon: response.icon_url,
					version,
					download
				};
			}

			async function getLatestVersion(versions) {
				if (versions.some(version => version === latestMcRelease)) {
					return latestMcRelease;
				}

				let highestMajor = 0;
				let highestMinor = 0;
				let highestPatch = 0;

				for (let j = 0; j < versions.length; j++) {
					const version = versions[j];

					if (SEMANTIC_REGEX.test(version)) {
						const parts = version.split('.');
						const major = parts[0];
						const minor = parts[1];
						const patch = parts[2] ?? 0;

						if (major > highestMajor) {
							highestMajor = major;
							highestMinor = 0;
							highestPatch = 0;
						}

						if (minor > highestMinor) {
							highestMinor = minor;
							highestPatch = 0;
						}

						if (patch > highestPatch) {
							highestPatch = patch;
						}
					}
				}

				let highestVersion = highestMajor + '.' + highestMinor;

				if (highestPatch > 0) {
					highestVersion += '.' + highestPatch;
				}

				return highestVersion;
			}

			async function getLatestVersionUrl(slug, version) {
				const versions = await callLatestVersionApi(slug, version);

				const releases = versions.filter(version => version.version_type === 'release');
				if (releases.length > 0) return releases[0].files[0].url;

				const betas = versions.filter(version => version.version_type === 'beta');
				if (betas.length > 0) return betas[0].files[0].url;

				return versions[0].files[0].url;
			}

			async function getLatestMinecraftRelease() {
				const versions = await callGameVersionsApi();
				const releases = versions.filter(version => version.version_type === 'release');
				return releases[0].version;
			}

			async function callApi(api) {
				const response = await fetch(api);
				return await response.json();
			}

			async function callProjectApi(slug) {
				return await callApi(`https://api.modrinth.com/v2/project/${slug}`);
			}

			async function callLatestVersionApi(modSlug, mcVersion) {
				return await callApi(`https://api.modrinth.com/v2/project/${modSlug}/version?loaders=\[%22fabric%22\]&game_versions=\[%22${mcVersion}%22\]&include_changelog=false`);
			}

			async function callGameVersionsApi() {
				return await callApi(`https://api.modrinth.com/v2/tag/game_version`);
			}

			function createDivHtml(mod) {
				let status = 'updated';
				let icon =
					`<svg xml:space="preserve" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5" clip-rule="evenodd" viewBox="0 0 104 104" aria-hidden="true">
						<path fill="none" d="M0 0h103.4v103.4H0z"></path>
						<path fill="none" stroke="#9a9a9a" stroke-width="5" d="M51.7 92.5V51.7L16.4 31.3l35.3 20.4L87 31.3 51.7 11 16.4 31.3v40.8l35.3 20.4L87 72V31.3L51.7 11"></path>
					</svg>`;

				if (mod.version !== latestMcRelease) {
					status = 'outdated';
				}

				if (mod.icon !== null && mod.icon !== undefined) {
					icon = `<img src="${mod.icon}" />`;
				}

				const html =
					`<div class="mod-icon">
						${icon}
					</div>
					<div class="mod-description">
						<h3>
							<a href="https://modrinth.com/mod/${mod.slug}" target="_blank">${mod.title}</a>
						</h3>
						<p>${mod.description}</p>
					</div>
					<a class="mod-download ${status}" href="${mod.download}">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
							<path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3v-1m-4-4-4 4m0 0-4-4m4 4V4"></path>
						</svg>
						${mod.version}
					</a>`;
				return html.trim();
			}
		</script>
	</head>
	<body>
		<h1>Mods I Use</h1>
		<p>In what I like to call "the good ol' days," the only mod that I ever used was OptiFine, as I am what many refer to so lovingly as a "vanilla purist." But as time went on and the OptiFine mod became slower, more bloated, buggier, and more aggressive with its modifications to the game, it became clear to me that an alternative was necessary. At which point I found the mod trio Sodium, Lithium, and Phosphor, alongside a group of other mods that fulfilled OptiFine's many other features. From that day forward, my list of vanilla-esque mods has continued to grow. What follows is my complete list of mods at present.</p>
		<p>All of these mods are used with the <a href="https://fabricmc.net/" target="_blank">Fabric Mod Loader</a>.</p>
		<div id="performance-list">
			<h2>Performance Optimizations</h2>
			<p>The following mods provide various performance optimizations across multiple layers and aspects of the game.</p>
		</div>
		<div id ="optifine-list">
			<h2>OptiFine/MCPatcher Features</h2>
			<p>The following mods offer the features of the old MCPatcher - later merged into OptiFine - ported to Fabric and improved upon.</p>
		</div>
		<div id="fixes-list">
			<h2>Bug Fixes</h2>
			<p>These mods simply fix bugs.</p>
		</div>
		<div id ="enhancements-list">
			<h2>Graphical and Audio Enhancements</h2>
			<p>These mods make slight enhancements to the world's graphics and sounds.</p>
		</div>
		<div id ="gui-list">
			<h2>GUI/HUD Improvements</h2>
			<p>These mods make improvements to the player's GUI and HUD, both for appearance and utility.</p>
		</div>
		<div id="tools-list">
			<h2>Tools</h2>
			<p>The following mods provide tools to assist with a variety of tasks.</p>
		</div>
		<div id="dependencies-list">
			<h2>Dependencies</h2>
			<p>The following mods are required by one or more of the mods above to function.</p>
		</div>
	</body>
</html>
